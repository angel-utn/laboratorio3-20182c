-- A) Listar los datos del cliente más joven. 
 SELECT CLI.* FROM CLIENTES AS CLI WHERE CLI.FNAC = (SELECT MAX(FNAC) FROM CLIENTES)

-- B) Listar los datos del artículo más barato. 
 SELECT ART.* FROM ARTICULOS AS ART WHERE ART.PU = (SELECT MIN(PU) FROM ARTICULOS)

-- C) Listar las localidades en las que no vive ningún cliente. 
SELECT LOC.* FROM LOCALIDADES AS LOC WHERE LOC.IDLOCALIDAD NOT IN (SELECT DISTINCT IDLOCALIDAD FROM CLIENTES)

-- D) Listar los artículos nacionales que no fueron vendidos. 
SELECT ART.* FROM ARTICULOS AS ART WHERE ART.ORIGEN = 'N' AND ART.IDARTICULO NOT IN (SELECT DISTINCT IDARTICULO FROM ARTICULOS_X_VENTA) 

-- E) Listar las marcas que no posean ningún artículo. 
SELECT M.* FROM MARCAS AS M WHERE M.IDMARCA NOT IN (SELECT DISTINCT IDMARCA FROM ARTICULOS WHERE IDMARCA IS NOT NULL) 

-- F) Listar todos los artículos más caros que cualquier artículo de marca 'PEPSI'. 
SELECT ART.* FROM ARTICULOS AS ART WHERE ART.PU >ALL (
    SELECT ART.PU FROM ARTICULOS 
    INNER JOIN MARCAS ON ARTICULOS.IDMARCA = MARCAS.IDMARCA
    WHERE MARCAS.DESCRIPCION LIKE '%PEPSI%' 
) 

-- G) Listar los artículos cuyo precio se encuentre por encima del precio promedio de los artículos 
-- importados. 
SELECT ART.* FROM ARTICULOS AS ART WHERE ART.PU > (
    SELECT AVG(PU) FROM ARTICULOS WHERE ORIGEN = 'I' 
)

--H) Por cada cliente, listar apellido y nombre, la cantidad comprada de unidades de artículos 
--nacionales e importados. 
SELECT CLI.APELLIDO, CLI.NOMBRE,
    (SELECT ISNULL(SUM(CANTIDAD), 0) FROM ARTICULOS_X_VENTA AS AXV 
    INNER JOIN VENTAS AS V ON V.IDVENTA = AXV.IDVENTA
    INNER JOIN ARTICULOS AS A ON A.IDARTICULO = AXV.IDARTICULO
    WHERE A.ORIGEN = 'N' AND V.DNI = CLI.DNI) AS CANTN,
    (SELECT ISNULL(SUM(CANTIDAD), 0) FROM ARTICULOS_X_VENTA AS AXV 
    INNER JOIN VENTAS AS V ON V.IDVENTA = AXV.IDVENTA
    INNER JOIN ARTICULOS AS A ON A.IDARTICULO = AXV.IDARTICULO
    WHERE A.ORIGEN = 'I' AND V.DNI = CLI.DNI) AS CANTI
FROM CLIENTES AS CLI

-- I) Listar todos los clientes que hayan comprado más unidades de artículos importados que 
-- nacionales. 
SELECT AUX.* FROM (
    SELECT CLI.APELLIDO, CLI.NOMBRE,
        (SELECT ISNULL(SUM(CANTIDAD),0) FROM ARTICULOS_X_VENTA AS AXV 
        INNER JOIN VENTAS AS V ON V.IDVENTA = AXV.IDVENTA
        INNER JOIN ARTICULOS AS A ON A.IDARTICULO = AXV.IDARTICULO
        WHERE A.ORIGEN = 'N' AND V.DNI = CLI.DNI) AS CANTN,
        (SELECT ISNULL(SUM(CANTIDAD),0) FROM ARTICULOS_X_VENTA AS AXV 
        INNER JOIN VENTAS AS V ON V.IDVENTA = AXV.IDVENTA
        INNER JOIN ARTICULOS AS A ON A.IDARTICULO = AXV.IDARTICULO
        WHERE A.ORIGEN = 'I' AND V.DNI = CLI.DNI) AS CANTI
    FROM CLIENTES AS CLI
) AS AUX
WHERE AUX.CANTI > AUX.CANTN


-- K) Listar todos los clientes que hayan comprado algún artículo nacional y ningún artículo 
-- importado.
SELECT AUX.* FROM (
    SELECT CLI.APELLIDO, CLI.NOMBRE,
        (SELECT ISNULL(SUM(CANTIDAD),0) FROM ARTICULOS_X_VENTA AS AXV 
        INNER JOIN VENTAS AS V ON V.IDVENTA = AXV.IDVENTA
        INNER JOIN ARTICULOS AS A ON A.IDARTICULO = AXV.IDARTICULO
        WHERE A.ORIGEN = 'N' AND V.DNI = CLI.DNI) AS CANTN,
        (SELECT ISNULL(SUM(CANTIDAD),0) FROM ARTICULOS_X_VENTA AS AXV 
        INNER JOIN VENTAS AS V ON V.IDVENTA = AXV.IDVENTA
        INNER JOIN ARTICULOS AS A ON A.IDARTICULO = AXV.IDARTICULO
        WHERE A.ORIGEN = 'I' AND V.DNI = CLI.DNI) AS CANTI
    FROM CLIENTES AS CLI
) AS AUX
WHERE AUX.CANTN > 0 AND AUX.CANTI = 0
